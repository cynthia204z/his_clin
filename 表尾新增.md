# 表尾新增



JNPF-table

```html
<JNPF-table
            v-loading="listLoading"
            :data="list"
            @sort-change="sortChange"
            @current-change="handleChange"
            ref="table"
            >
  
 	<!-- 原本的欄位們 -->
  
  <!-- ★★★ 最下方加表尾插槽 -->
  <template v-slot:append>
    <!-- LovSelect標籤用法沒有改變，是一樣的組件 -->
    <!-- 加 style="margin: 3px"，避免邊線擠在一起-->
    <LovSelect
               style="margin: 3px"
               :parent-value.sync="search.chartNo"
               type="page"
               :apiUrl="selectApi"
               :lovQueryColume="lovQueryColume2"
               :lovColumeList="lovColumeList"
               optionLabel="chartNo"
               optionValue="chartNo"
               placeholder="查詢病歷號碼/姓名/身分證，新增一筆資料"
               @lovEvent="lovEvent2"
               ref="lovSelect2"
               ></LovSelect>

  </template>
</JNPF-table>
```

Data

```js
data() {
  return {
    dataForm: {
      version: 0,
      inNo: undefined,
      idNo: undefined,
      chartNo: undefined,
      patName: undefined,
      birthDate: undefined,
      cjdFlag: undefined,
    },
    // 以下跟普通的LovSelect相同
    search: {
      chartNo: undefined,
    },
    selectItemData2: {},
    selectItemDataState2: false,
    lovQueryColume2: {
      keyword: undefined,
    },
  }
}
```

Watch

```js
// 同LovSelect
watch:{
  selectItemDataState2: {
    handler(val) {
      if (!val && val != false) return;
      this.changeColumeValue2();
    },
      deep: true,
  },
}
```

Function

```js
methods:{
  lovEvent2(data) {
    if (data) {
      // 儲存Lov回傳的資料
      this.selectItemData2 = data;
      // 告訴watch資料存好了
      this.selectItemDataState2 = true;
    }
  },
    changeColumeValue2() {
      if (this.selectItemDataState2) {
        // 將資料加入list
         this.list.push(this.selectItemData2);
      }
      this.selectItemDataState2 = false;
      // ----這邊請依需求自行加 post request
      this.$nextTick(() => {
        // 讓表格滾動條維持在底部
        let container = this.$el.querySelector(".el-table__body-wrapper");
        container.scrollTop = container.scrollHeight;
        // 清空儲存的資料
        this.selectItemData2 = this.dataForm;
        // 清空Lov綁定值
        this.search.chartNo = undefined;
      });
    },
}
```

> 示範頁在 his7/demo/rolin/tableadd

